<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title></title>
  <link rel="stylesheet" href="css/updates.css">
</head>
<body>
  <script>
    const name = new URLSearchParams(window.location.search).get('name');
    if (!name) {
      document.body.textContent = 'Name parameter is missing';
      throw new Error('Name parameter is missing');
    }

    fetch('Updates By Season.json')
      .then(res => res.json())
      .then(data => {
        const entry = Object.values(data).reduce((acc, season) => acc || season[name], data[name] || null);
        if (!entry) {
          document.body.textContent = `No data found for '${name}'`;
          throw new Error(`No data found for '${name}'`);
        }

        document.title = entry.title || name;

        const createLinkH2 = (href, text) => {
          const h2 = document.createElement('h2');
          h2.className = 'justLink';
          const a = document.createElement('a');
          a.href = href;
          a.textContent = text;
          h2.appendChild(a);
          return h2;
        };

        const recapDiv = document.createElement('div');
        recapDiv.id = 'recap';
        if (entry.recap?.recapBody) {
          recapDiv.innerHTML = entry.recap.recapBody;
          const heading = recapDiv.querySelector('h1, h2, h3, h4, h5, h6');
          const link = heading?.querySelector('a');
          if (link && entry.recap.recapLink) {
            link.href = `https://sharktankups.netlify.app/recap.html?link=${encodeURIComponent(entry.recap.recapLink)}`;
          }
        } else if (entry.recap?.recapLink) {
          recapDiv.appendChild(createLinkH2(entry.recap.recapLink, entry.recap.recapLink));
          recapDiv.appendChild(createLinkH2(`https://sharktankups.netlify.app/recap.html?link=${encodeURIComponent(entry.recap.recapLink)}`, 'Test Page'));
        }
        if (recapDiv.hasChildNodes()) document.body.appendChild(recapDiv);

        const blogDiv = document.createElement('div');
        blogDiv.id = 'blog';
        if (entry.blog?.blogBody) {
          blogDiv.innerHTML = entry.blog.blogBody;
        } else if (entry.blog?.blogLink) {
          blogDiv.appendChild(createLinkH2(entry.blog.blogLink, entry.blog.blogLink));
        }
        if (blogDiv.hasChildNodes()) document.body.appendChild(blogDiv);
      })
      .catch(err => {
        console.error(err);
        if (!document.body.textContent) document.body.textContent = 'Error loading updates.';
      });
  </script>
</body>
</html>